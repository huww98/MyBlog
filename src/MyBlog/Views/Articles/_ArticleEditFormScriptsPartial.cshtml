@{await Html.RenderPartialAsync("_CategorySelectorScriptPartial");}

<environment names="Development">
    <script src="~/lib/remarkable/dist/remarkable.js"></script>
    <script src="~/lib/bootstrap-fileinput/js/fileinput.js"></script>
</environment>
<environment names="Staging,Production">
    <script src="~/lib/remarkable/dist/remarkable.min.js"></script>
    <script src="~/lib/bootstrap-fileinput/js/fileinput.min.js"></script>
</environment>
<script src="~/lib/bootstrap-fileinput/themes/fa/theme.js"></script>
<script src="~/lib/bootstrap-fileinput/js/locales/zh.js"></script>
<script type='text/javascript'>
    mdHtml = new window.Remarkable('commonmark');
    function updatePreview() {
        var source = $("#Content").val();
        $('#markdown-html').html(mdHtml.render(source));
    };
    updatePreview();
    $("#Content").on("input", updatePreview);

    $("#imageFile").fileinput({
        language: 'zh',
        theme: 'fa',
        uploadUrl: '/UploadImage',
        allowedFileExtensions: ["jpg", "png", "gif"],
        fileActionSettings: { showZoom: false }
    });
    $('#imageFile').on('fileuploaded', function (event, data, previewId, index) {
        var response = data.response;
        var content = document.getElementById("Content");
        var startPos = content.selectionStart,
            endPos = content.selectionEnd,
            tmpStr = content.value;
        content.value = tmpStr.substring(0, startPos) + "![](" + response.src + ")" + tmpStr.substring(endPos, tmpStr.length);
        updatePreview();
    });
</script>
@{await Html.RenderPartialAsync("_ValidationScriptsPartial");}